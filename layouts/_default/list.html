{{ define "main" }}
<h1 class="page-title">{{ .Title }}</h1>
{{ .Content }}

{{ $pages := .Pages.ByDate.Reverse }}
{{ $currentYear := "" }}
{{ range $pages }}
  {{ $year := (dateFormat "2006" .Date) }}
  {{ if ne $year $currentYear }}
    {{ if ne $currentYear "" }}</div>{{ end }}
    <div class="year-group">
    <div class="year-label">{{ $year }}</div>
    {{ $currentYear = $year }}
  {{ end }}
  <div class="entry{{ with .Params.featured_image }} has-image{{ end }}">
    {{ with .Params.featured_image }}
    <div class="entry-image">
      <img src="{{ strings.TrimLeft "/" . | absURL }}" alt="Paper figure" loading="lazy">
    </div>
    {{ end }}
    <div class="entry-content">
      {{ $title := .Title }}
      <h3>{{ with .Params.paper_url }}<a href="{{ . }}" target="_blank">{{ $title }}</a>{{ else }}{{ with .Params.arxiv }}<a href="https://arxiv.org/abs/{{ . }}" target="_blank">{{ $title }}</a>{{ else }}{{ $title }}{{ end }}{{ end }}</h3>
      {{ with .Params.authors }}<p class="entry-authors">{{ . }}</p>{{ end }}
      {{ with .Params.journal }}<p class="entry-journal">{{ . }}</p>{{ end }}
      {{/* date shown via year grouping, not per-card */}}
      {{ with .Params.event }}<p class="entry-meta">{{ . }}{{ with $.Params.type }} Â· {{ . }}{{ end }}</p>{{ end }}
      {{ with .Params.description }}<p class="entry-desc">{{ . }}</p>{{ end }}
      {{ if or .Params.arxiv .Params.pdf }}
      <div class="entry-links">
        {{ with .Params.arxiv }}<a href="https://arxiv.org/abs/{{ . }}" target="_blank">arXiv:{{ . }}</a>{{ end }}
        {{ with .Params.pdf }}<a href="{{ . }}" target="_blank">PDF</a>{{ end }}
        {{ with .Params.arxiv }}{{ $bibPath := printf "static/bib/%s.bib" . }}{{ $bib := "" }}{{ with readFile $bibPath }}{{ $bib = . }}{{ end }}{{ if $bib }}<button class="bibtex-btn" data-bib="{{ $bib | htmlEscape }}" onclick="copyBibtex(this)">BibTeX</button>{{ end }}{{ end }}
      </div>
      {{ end }}
    </div>
  </div>
{{ end }}
{{ if ne $currentYear "" }}</div>{{ end }}
{{ end }}
